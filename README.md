# 模块化的 rCore-Tutorial

- 只需要维护一个分支！
- 支持 Windows 直接调试！

  - 需要安装 Rust 环境 和 windows qemu
  - 当然 Linux 也支持，其实就是跨平台

## 目录

- [宗旨](#宗旨)
  - [协作政策](#协作政策)
- [命令参考](#命令参考)
- [设计说明](#设计说明)
- [进度](#进度)

## 宗旨

本项目目标是实现一个存在于单独仓库、单独分支的完整操作系统教程。

“一个操作系统教程”定义为由一系列章节组成的，用于学习操作系统的文本和代码资料。用户可按照自然的顺序阅读这些章节，逐步了解操作系统的发展史和原理性的技术细节。因此，在本文的后续部分，将用户称为学生，将使用过程称为学习。

我假设学生在学习本教程前对 Rust 语言有充分的了解，因为我希望在编写时尽量使用 Rust 带来的方便，不必受受众的掣肘。

我希望，学生在学习本教程时可以专注于 Rust 和操作系统本身。因此，教程不要求用户精通操作 git，`git clone` 只是获取教程的手段之一，与下载 zip 或从他人处拷贝没有本质区别（当然，使用 git 会对学习过程有帮助）；并且会尽量跨平台，为此，可能需要在构建系统中增加一些平台相关的操作。

本教程**并不期望在章节设置或教学内容上有所创新**，也不是为了实验任何新的内核技术，rCore-Tutorial-v3 足够优秀。本项目仅关注**教程的构建过程和学生的学习体验**（换句话说，如果为了这两点，修改章节设置和教学内容也可以接受）。在此基础之上，我希望尽量使用 Rust 的机制减少“构造一个操作系统”的代码量，以及使得库构建规范化、可迁移。

### 协作政策

本项目**不是、也无意成为相关工作的典范**。如果你：

- 认为项目的操作非常合适，欢迎共同开发；
- 你不喜欢某些更新，请发起讨论，或从任何提交分叉；
- 认同项目的目标但不认同其设计，可以创建己的仓库；

因此，本项目使用 [WTFPL](LICENSE) 开源，如果你不喜欢，可以改名字或在你的分叉里直接删除它，这都是它本身支持的。

另外，本项目具有实验性。这意味着它随时可能发生设计变更、破坏性重构、移动、废弃或删除。

## 命令参考

> 下列命令在本文档所在目录及其所有子目录中运行都产生一样的效果，因此没必要 cd 到某处

- **cargo qemu --ch `n`**

  在 qemu 运行第 `n` 章的操作系统。

- **cargo qemu --ch `n` --lab**

  在 qemu 运行第 `n` 章的操作系统实验。

## 设计说明

我对 [workspace](Cargo.toml) 中的 crate 做以下分类：

- **程序**
  - **内核**

    能编译出内核。显然教程每章应该编译出一个内核，但所有章节都在一个 bin crate，或者每章/实验都在独立的 bin crate，或者分成一些组？还不确定。

  - **测例**

    教程中出现不编译出内核的 bin crate 的唯一理由就是需要对内核进行测试。

    - **内核测例**

      运行在内核态，测试某些组件，或者说是不能带用户程序的特殊内核（不一定最后会有）。

    - **用户测例**

      能运行在某些章节内核中的用户程序。

  - **工具**

    运行在开发环境的应用程序，比如 [xtask](xtask)。

- **库**
  - **规范**

    根据某种成文规范实现的库，类似 [riscv](https://github.com/rust-embedded/riscv)。规范库可能是接口库也可能是实现库，以正确反映规范文本为佳。这类库应该在自述文件中给出依据的规范文本（的链接），尤其是要指定规范版本以及当前实现的完整性。

    这类库具有最大的迁移性，仅取决于其参照的规范文本的迁移性。如果完善到一定程度，可以独立到专用仓库并发布。

  - **接口**

    这种库用于规范实现，方便在不同内核之间迁移。一旦最终决定有多个编译出内核的 bin crate，必然存在使实现在它们之间迁移的接口库。

  - **实现**

    普通的 lib crate。如果对同一功能可能有多种实现，可能使用 cfg feature 或抽象出接口库。

## 进度

完成第一章。
